{% macro render() %}
{%- if page.comment !== false %}
  {%- if is_post() !== false %}
    <div id="webmentions"></div>
  {%- endif %}
  <div class="wrap" id="comments"></div>
  <script>
    let fun = () => console.log('Let me sleep for a while ðŸ¤¡');
    let sleep = function(fun,time){
      setTimeout(()=>{
        fun();
      },time);
    }
    sleep(fun,1000);
    
    let html = '';
    const webmentionsPromise = fetch("https://webmention.io/api/mentions.jf2?target=" + encodeURIComponent(window.location.href))
      .then(function (response) {
          console.log('ðŸ¥¸ðŸ¤¡ Webmention is ready.');
          return response.json();
      })
      .catch(function (e) {
          console.error(e);
      });
    const distinctMentions = [
      ...new Map(webmentionsPromise.children.map((item) => [item.author.url, item])).values()].sort((a, b) => new Date(a['wm-received']) - new Date(b['wm-received']));
    html += `<div className="webmention-avatars">`;
    distinctMentions.forEach(function (reply) {
      html += `<a class="avatar-wrapper" href=${reply.author.url} key=${reply.author.name}><image class="wm-avatar" loading="lazy" src=${reply.author.photo != "" ? reply.author.photo: "https://gravatar.loli.net/avatar/72bb6865ec4888f0d8949b71dea2137d?size=80&d=mp"} data-nimg="fill" sizes="(max-width: 768px) 100vw,(max-width: 1200px) 50vw, 33vw"/></a>`;
    });
    html += `</div>`;
  </script>
{%- endif %}
{% endmacro %}
